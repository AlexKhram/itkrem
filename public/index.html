<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
	<link rel="stylesheet" href="https://code.getmdl.io/1.2.1/material.indigo-pink.min.css">
	<script defer src="https://code.getmdl.io/1.2.1/material.min.js"></script>
</head>
<body>
<style type="text/css">
.mdl-card {
	position:relative;
 	/*opacity: .99;*/
 	z-index: 0;
}
.mdl-card__media {
    margin: 0;
}
.cards-section {
  max-width: 1024px;
}
</style>
<div class="mdl-layout mdl-js-layout mdl-color--grey-100">
    <main class="mdl-layout__content">
    	<div id="eventBody" class="mdl-grid cards-section"></div>
        <div id="contentBody" class="mdl-grid cards-section"></div>
    </main>
</div>
<script>
var xhr = new XMLHttpRequest();
xhr.open('GET', 'https://itkrem-a14ca.firebaseio.com/events.json?orderBy="date"', true);
xhr.send();
xhr.onreadystatechange = function() {
        if (xhr.readyState == 4 && xhr.status == 200) {
            
            try {
                var data = JSON.parse(xhr.responseText);
                
                for (var key in data) {
 					var divCard = document.createElement('div');
 					divCard.className = "mdl-cell mdl-cell--4-col mdl-cell--8-col-tablet mdl-cell--4-col-phone mdl-card mdl-shadow--2dp";
 					divCard.tabIndex = "1";

					//actions
					divCard.onblur = function(){
						contentBody.appendChild(this);
						this.classList.add("mdl-cell--4-col"); 
						this.classList.remove("mdl-cell--12-col");
					};
					
					divCard.onfocus = (function() {
						var searchName = data[key]['searchName'];
						return function(){	
						eventBody.appendChild(this);
						this.classList.add("mdl-cell--12-col");
						this.classList.remove("mdl-cell--4-col");
						this.focus();
						history.pushState('', '', "/"+searchName);
						// history.pushState('', '', "/"+this.children[0].innerHTML);
						};
					})();
					

					divCard.onmouseover = function(){
						this.classList.add("mdl-shadow--6dp");
						this.classList.remove("mdl-shadow--2dp");
					};

 					divCard.onmouseout = function(){
 						this.classList.add("mdl-shadow--2dp");
 						this.classList.remove("mdl-shadow--6dp");
 					};

 					// var divSearchName = document.createElement('div');
 					// divSearchName.innerHTML = data[key]['searchName'];
 					// divSearchName.style.display = "none";


					var divTitleText = document.createElement('div');
					divTitleText.className = "mdl-card__title";
					divTitleText.innerHTML = data[key]['name'];

 					var divTitle = document.createElement('div');
 					divTitle.className = "mdl-card__title";
 					divTitle.style.background = "url('" + data[key]['image'] + "') center/cover"; 
 					divTitle.style.minHeight = "250px";
 					divTitle.style.width = "100%";
 	
 					// var h2Title = document.createElement('h2');
 					// h2Title.className = "mdl-card__title-text";
 					// h2Title.innerHTML = data[key]['name'];

					// divTitle.innerHTML = data[key]['name'];
					// var divMedia = document.createElement('div');
					// divMedia.className = "mdl-card__media";
					// var img = document.createElement("IMG");
					// img.src = data[key]['image'];
					var divDesc = document.createElement('div');
					divDesc.className = "mdl-card__supporting-text";
					divDesc.innerHTML = data[key]['desc'].substring(0,150)+"...";

					

					var divAction = document.createElement('div');
					divAction.className = "mdl-card__actions mdl-card--border";
					var aLink = document.createElement('a');
					aLink.href = data[key]['link'];
					aLink.target="_blank";
					var spanDAte = document.createElement('span');
					// spanDAte.className = "mdl-button--primary"; //mdl-button--primary / mdl-button--accent
					spanDAte.className = "mdl-button mdl-js-button mdl-button--primary";
					spanDAte.innerHTML = data[key]['date'];

					// divCard.appendChild(divSearchName);
					divCard.appendChild(divTitle);
					divCard.appendChild(divTitleText);
					divCard.appendChild(divDesc);
					aLink.appendChild(spanDAte);
					divAction.appendChild(aLink);
					divCard.appendChild(divAction);

					contentBody.appendChild(divCard);
	
					//router
					if("/"+data[key]['searchName'] == location.pathname){
						divCard.focus();
					}
					
				}
            } catch(err) {
                console.log(err.message + " in " + xhr.responseText);
                return;
            }   
    };
}
</script>


</html>